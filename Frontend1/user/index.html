<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS v5.3.2 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    
    <title>POS Dashboard</title>
    <link rel="stylesheet" href="index.css">
    <style>
        .logout-btn {
            padding: 7.5px 15px;
            background-color: #dc3545;
            color: white;
            font-size: 13px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 7px;
            transition: background-color 0.3s ease;
            margin-right: 5px;
        }

        .logout-btn:hover {
            background-color: #c82333;
        }
        #admin-btn{
            padding: 7.5px 15px;
            background-color: #0d7c2f;
            color: white;
            font-size: 13px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 7px;
            transition: background-color 0.3s ease;
            margin-right: 5px;
        }
        #admin-btn:hover{
            background-color: #25b450;
            
        }


        .modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1000;
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        width: 500px;
        padding: 20px;
        height: 700px;
        background: rgba(255, 255, 255, 0);
       

    }

    .modal-content {
        text-align: center;
    }

    .modal h3 {
        margin-bottom: 20px;
    }

    .payment-option {
        margin-bottom: 15px;
        text-align: left;
    }

    .conditional-input {
        display: none;
        margin-top: 10px;
    }

    .modal-actions {
        margin-top: 20px;
    }

    .btn {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn-confirm {
        background-color: #4CAF50;
        color: white;
    }

    .btn-cancel {
        background-color: #f44336;
        color: white;
    }
    #exchangeDetails {
    resize: none; /* Prevent resizing if you want a fixed height */
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 8px;
    font-size: 14px;
    font-family: inherit;
    width: 100%;
    height: 200px;
}
    #chequeNumber{
        width: 100%;
        height: 50px;
    }
    /* Overlay Styling */
    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
    }
    </style>
</head>

<body>
    <header>
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link active" href="allcos.html">ALL CUSTOMER</a></li>
                        <li class="nav-item"><a class="nav-link" href="index.html">Dashboard</a></li>
                        <li class="nav-item"><a class="nav-link" href="vender.html">Vender</a></li>
                        <li class="nav-item"><a class="nav-link" href="stock.html">Stock</a></li>
                        <li class="nav-item"></li>
                            <a class="nav-link" href="vendorAdd.html">Add Supply</a>
                        </li>
                    </ul>
                    <!-- Admin Button -->
                    <button id="admin-btn" class="btn btn-outline-">Admin</button>
                    <!-- logout button -->
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <!-- Current Sale Section -->
        <div class="current-sale">
            <div id="print">
                <h2>Current Sale</h2>
                <ul id="sale-items"></ul>
                <p>Sub-total: <span id="sub-total">RS:0.00</span></p>
                
                <p>Tax (NZ GST): <span id="tax">RS:0.00</span></p>
                <p><b>Total Discount:<span id="totalDiscountEl"> $0.00</span></b></p>
                <p><b>TOTAL: <span id="total">RS:0.00</span></b></p>
            </div>
            <p>
                <label for="tax-input">Tax:</label>
                <input type="number" id="tax-input" placeholder="Enter tax amount" />
            </p>    
                <!-- Customer ID Input -->
                <div class="vendor-id">
                    <label for="vendor-id-input">Customer ID:</label>
                    <button id="open-modal-btn">Select Customer</button>
                    <input type="text" id="vendor-id-input" placeholder="Customer ID" >

                </div>
            
            <!-- Modal structure -->
            <div id="vendor-modal" class="modal">
                <div class="modal-content">
                    <span class="close-btn">&times;</span>
                    <h2>Select Customer</h2>
                    <ul id="vendor-list"></ul>
                </div>
            </div>
            <select id="signal" name="signal">
                <option value=1>Pay</option>
                <option value=0>Debt</option>
            </select>
            <!-- Save Receipt Button -->
            <button id="save-receipt-button" >Save  Receipt</button>
            <button id="print-receipt-button" onclick="printPage()"> Print Receipt</button>
            
        </div>

        <!-- Categories Section -->
        <div class="categories">
            <h1>Categories</h1>
            <div class="search-bar">
                <input type="text" id="product-search" placeholder="Search product...">
            </div>
            <div id="categoryButtons" class="category-buttons"></div>
        </div>

        <!-- Products Section -->
        <div class="products">
            <h2>Products</h>
            <div id="product-list"></div>
        </div>
    </div>
    <div class="modal fade" id="passwordModal" tabindex="-1" aria-labelledby="passwordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="passwordModalLabel">Enter Admin Password</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="admin-password" class="form-label">Password</label>
                <input type="password" class="form-control" id="admin-password" placeholder="Enter your password" required>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" id="confirm-password-btn">Confirm</button>
            </div>
          </div>
        </div>
      </div>
      <div id="paymentModal" class="modal">
        <div class="modal-content">
            <h3>Select Payment Option</h3>
            <form id="paymentForm">
                <div class="payment-option">
                    <label>
                        <input type="radio" name="paymentOption" value="Cash" /> Cash
                    </label>
                </div>
                <div class="payment-option">
                    <label>
                        <input type="radio" name="paymentOption" value="Cheque" /> Cheque
                    </label>
                    <div id="chequeInput" class="conditional-input">
                        <label for="chequeNumber">Cheque Number:</label>
                        <input type="text" id="chequeNumber" />
                    </div>
                </div>
                <div class="payment-option">
                    <label>
                        <input type="radio" name="paymentOption" value="Exchange" /> Exchange
                    </label>
                    <div id="exchangeInput" class="conditional-input">
                        <label for="exchangeDetails">Exchange Details:</label>
                        <textarea id="exchangeDetails" rows="4"></textarea>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" id="confirmPaymentButton" class="btn btn-confirm">Confirm</button>
                    <button type="button" id="closeModalButton" class="btn btn-cancel">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    <div id="overlay" class="overlay"></div>

    <script>
       
        // Function to print the page
        function printPage() {
    const container = document.getElementById("print");
    if (!container) {
        console.error("Error: 'container' not found.");
        return;
    }

    console.log("Container HTML for print:", container.innerHTML); // Debugging

    const originalContent = document.body.innerHTML; // Save original content
    document.body.innerHTML = container.innerHTML; // Replace body content

    // Wait for DOM update before triggering print
    setTimeout(() => {
        window.print(); // Open print dialog
        document.body.innerHTML = originalContent; // Restore content
        location.reload(); // Optional: Reload to restore state
    }, 200); // Slight delay ensures rendering
    }
    function printCurrentSaleAndPayment(data) {
    // Destructure the data object for easier access
    const {
        customer_id,
        purchase_date,
        total_price,
        payment_status,
        user_id,
        items,
        payment_detail,
        discount
    } = data;

    // Create a new window for printing
    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write('<html><head><title>Print Receipt</title>');
    printWindow.document.write('<style>');
    printWindow.document.write(`
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section h2 {
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        .receipt-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .receipt-table th, .receipt-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .receipt-table th {
            background-color: #f4f4f4;
        }
        .summary {
            margin-top: 20px;
        }
        .summary p {
            font-weight: bold;
        }
    `);
    printWindow.document.write('</style></head><body>');

    // Add header section
    printWindow.document.write('<div class="section">');
    printWindow.document.write('<h2>Customer Receipt</h2>');
    printWindow.document.write(`<p><strong>Customer ID:</strong> ${customer_id}</p>`);
    printWindow.document.write(`<p><strong>Purchase Date:</strong> ${purchase_date}</p>`);
    printWindow.document.write(`<p><strong>Payment Status:</strong> ${payment_status == 1 ? 'Paid' : 'Debt'}</p>`);
    printWindow.document.write(`<p><strong>Processed By (User ID):</strong> ${user_id}</p>`);
    printWindow.document.write('</div>');

    // Add items table
    printWindow.document.write('<div class="section">');
    printWindow.document.write('<h2>Purchased Items</h2>');
    printWindow.document.write('<table class="receipt-table">');
    printWindow.document.write('<thead><tr><th>Product ID</th><th>Price</th><th>Quantity</th><th>Total</th></tr></thead><tbody>');
    items.forEach(item => {
        const itemTotal = (item.price * item.quantity).toFixed(2);
        printWindow.document.write(`<tr>
            <td>${item.product_id}</td>
            <td>RS:${item.price.toFixed(2)}</td>
            <td>${item.quantity}</td>
            <td>RS:${itemTotal}</td>
        </tr>`);
    });
    printWindow.document.write('</tbody></table>');
    printWindow.document.write('</div>');

    // Add summary section
    printWindow.document.write('<div class="summary">');
    printWindow.document.write(`<p><strong>Discount:</strong> RS:${discount.toFixed(2)}</p>`);
    printWindow.document.write(`<p><strong>Total Price:</strong> RS:${total_price.toFixed(2)}</p>`);
    printWindow.document.write(`<p><strong>Payment Details:</strong> ${payment_detail}</p>`);
    printWindow.document.write('</div>');

    // Close the document
    printWindow.document.write('</body></html>');
    printWindow.document.close();

    // Trigger the print dialog
    printWindow.print();

    // Close the print window after printing
    printWindow.onafterprint = function () {
        printWindow.close();
    };
}


//print end
        const categories = {};
        const billItems = [];
        let currentCustomer = { id: "0", name: "Customer Zero" };
        let currentSale = [];
        const taxRate = 0.15;
        const token = localStorage.getItem('token'); 
        if(!token){
            window.location.href = 'login.html';
        }
        let uid;
        function getUserIdFromToken() {
            // Retrieve the token from local storage
            if (!token) {
                console.error('No token found in local storage');
                return null;
            }
    
            // Decode the token
            const payload = token.split('.')[1];
            const decodedPayload = JSON.parse(atob(payload));
    
            // Extract the user ID (assuming it's stored under 'userId' in the payload)
            const userId = decodedPayload.userId;
            uid=userId;
            return userId;
        }
    
        // Function to load categories and products
        async function loadCategories(userId) {
            try {
                // Fetch the categories
                const response = await fetch(`http://localhost:5000/api/v1/product/categories/${userId}`);
                const data = await response.json();
    
                if (data.success) {
                    // Clear previous categories
                    Object.keys(categories).forEach(key => delete categories[key]);
    
                    // Populate category buttons
                    const categoryButtonsContainer = document.getElementById('categoryButtons');
                    categoryButtonsContainer.innerHTML = '';
    
                    // Fetch products by category
                    for (const category of data.data) {
                    const categoryName = category.category;
                    const encodedCategoryName = encodeURIComponent(categoryName);

                    // Fetch products for each category
                    const productsResponse = await fetch(`http://localhost:5000/api/v1/product/ProductByCategory/${userId}?categoryName=${encodedCategoryName}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    const productsData = await productsResponse.json();

                    if (productsData.success) {
                        // Filter out products with quantity 0
                        const filteredProducts = productsData.data.filter(product => product.quantity > 0);

                        // Map filtered products
                        categories[categoryName] = filteredProducts.map(product => ({
                            productId: product.product_id,
                            name: product.name,
                            price: product.price,
                            category: categoryName
                        }));

                        // Add category button
                        const button = document.createElement('button');
                        button.className = 'category-btn';
                        button.textContent = categoryName;
                        button.onclick = () => displayProducts(categoryName);
                        categoryButtonsContainer.appendChild(button);
                    } else {
                        console.error(`No products found for category: ${categoryName}`);
                    }
                }

    
                    // Optionally, display the default or first category
                    if (data.data.length > 0) {
                        displayProducts(data.data[0].category);
                    }
                } else {
                    console.error('No categories found');
                }
            } catch (error) {
                console.error('Error fetching categories:', error);
            }
        }
    
        // Function to display products for the selected category
        function displayProducts(categoryName) {
            const products = categories[categoryName]; // Get products for the selected category
    
            // Check if there are products for the selected category
            if (!products || products.length === 0) {
                console.error(`No products found for category: ${categoryName}`);
                return;
            }
    
            // Render products in the product-list div
            const productList = document.getElementById('product-list');
            productList.innerHTML = ''; // Clear previous products
    
            products.forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.classList.add('product-item');
                productDiv.innerHTML = `
                    <span>${product.name}</span>
                     <span>${product.price}</span>
                    <button class="product-button" data-name="${product.name}" data-id="${product.productId}" data-price="${product.price}">Add</button>
                   
                `;
                productList.appendChild(productDiv);
            });
        }
        function update(){
            updateSaleUI();
        }
        document.addEventListener('DOMContentLoaded', () => {
            const productList = document.getElementById('product-list');
            const saleItems = document.getElementById('sale-items');
            const subTotalEl = document.getElementById('sub-total');
            const taxEl = document.getElementById('tax');
            const totalEl = document.getElementById('total');
            const searchInput = document.getElementById('product-search');
            const categoryButtonsContainer = document.getElementById('categoryButtons');
            const customerIdInput = document.getElementById('vendor-id-input');
            const saveReceiptButton = document.getElementById('save-receipt-button');
            const total_discount= document.getElementById('totalDiscountEl');
    
            // Filter products by category and search term
            function filterProducts(category, searchTerm = '') {
                const filteredProducts = Object.entries(categories)
                    .flatMap(([cat, products]) =>
                        products.filter(p => (category === 'all' || p.category === category) &&
                            p.name.toLowerCase().includes(searchTerm.toLowerCase()))
                    );
                renderProducts(filteredProducts);
            }
    
            // Event listeners for category buttons
            categoryButtonsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('category-btn')) {
                    const category = e.target.textContent;
                    const searchTerm = searchInput.value;
                    filterProducts(category, searchTerm);
                }
            });
    
            // Search functionality with category filtering
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value;
                const selectedCategory = document.querySelector('.category-buttons .category-btn.active')?.textContent || 'all';
                filterProducts(selectedCategory, searchTerm);
            });
    
            // Render products dynamically
            function renderProducts(productArray) {
                productList.innerHTML = '';
                productArray.forEach(product => {
                    const productDiv = document.createElement('div');
                    productDiv.classList.add('product-item');
                    productDiv.innerHTML = `
                        <span>${product.name}</span>
                          <span>${product.price}</span>
                        <button class="product-button" data-name="${product.name}" data-id="${product.productId}" data-price="${product.price}">Add</button>
                    `;
                    productList.appendChild(productDiv);
                });
            }
    
            // Add product to sale with quantity control
            productList.addEventListener('click', (e) => {
                if (e.target.classList.contains('product-button')) {
                    const productName = e.target.getAttribute('data-name');
                    const productId=e.target.getAttribute('data-id');
                   // console.log(productId);
                    const productPrice = parseFloat(e.target.getAttribute('data-price'));
                    const product = { name: productName,id:productId, price: productPrice };
                    addToSale(product);
                }
            });
    
            // Function to add product to the current sale
            function addToSale(product) {
                const existingItem = currentSale.find(item => item.name === product.name);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    currentSale.push({ ...product, quantity: 1 });
                }
                updateSaleUI();
            }
    
            // Function to update the sale UI and calculate totals
            function updateSaleUI() {
    saleItems.innerHTML = '';
    let subTotal = 0;
    let totalDiscount = 0;

    currentSale.forEach(item => {
        const listItem = document.createElement('li');
        
        // Display item details
        listItem.textContent = `${item.name} - $${item.price.toFixed(2)} x ${item.quantity}`;
        
        // Create a discount input field
        const discountInput = document.createElement('input');
        discountInput.type = 'number';
        discountInput.placeholder = 'Discount';
        discountInput.value = item.discount || 0; // Default discount value
        discountInput.style.marginLeft = '10px';
        discountInput.onchange = () => {
            const discountValue = parseFloat(discountInput.value) || 0;
            item.discount = discountValue; // Save discount for the item
            updateSaleUI(); // Recalculate totals and update UI
        };

        // Create a button to decrease quantity
        const decreaseButton = document.createElement('button');
        decreaseButton.textContent = '-';
        decreaseButton.onclick = () => {
            decreaseQuantity(item);
            updateSaleUI(); // Update UI after quantity change
        };

        // Append elements to the list item
        listItem.appendChild(discountInput);
        listItem.appendChild(decreaseButton);
        saleItems.appendChild(listItem);

        // Calculate discounted price for the item
        const effectivePrice = item.price;
        const itemTotal = Math.max(0, effectivePrice) * item.quantity; // Ensure price is not negative
        subTotal += itemTotal - (item.discount || 0);
        
        // Add discount for this item to total discount (only once, not per quantity)
        totalDiscount += item.discount || 0;
    });

    // Get tax value from user input
     // Default to 0 if no input or invalid value
     let taxInput = document.getElementById('tax-input');
     taxInput.addEventListener('change', updateSaleUI);
     let taxValue = parseFloat(taxInput.value) || 0;
    // Update subtotal, tax, total, and total discount
    subTotalEl.textContent = `${subTotal.toFixed(2)}`;
    taxEl.textContent = `${taxValue.toFixed(2)}`; // Display user input tax value
    totalEl.textContent = `${(subTotal + taxValue).toFixed(2)}`; // Add tax value directly to subtotal
    totalDiscountEl.textContent = `${totalDiscount.toFixed(2)}`; // Update total discount field
}

            // Function to decrease quantity
            function decreaseQuantity(item) {
                const existingItem = currentSale.find(i => i.name === item.name);
                if (existingItem.quantity > 1) {
                    existingItem.quantity--;
                } else {
                    // If quantity is 1, remove the item
                    currentSale = currentSale.filter(i => i.name !== item.name);
                }
                updateSaleUI();
            }
            
              
            const signalSelect = document.getElementById('signal');
            // Save and print receipt functionality
            const paymentModal = document.getElementById('paymentModal');
            const overlay = document.getElementById('overlay');
            const confirmPaymentButton = document.getElementById('confirmPaymentButton');
            const closeModalButton = document.getElementById('closeModalButton');
            const chequeInput = document.getElementById('chequeInput');
            const exchangeInput = document.getElementById('exchangeInput');
            const chequeNumberInput = document.getElementById('chequeNumber');
            const exchangeDetailsInput = document.getElementById('exchangeDetails');

            let paymentDetails = ""; // This will store the payment details

            saveReceiptButton.addEventListener('click', () => {
        // Open the modal
                paymentModal.style.display = 'block';
                overlay.style.display = 'block';
            })

        document.querySelectorAll('input[name="paymentOption"]').forEach(option => {
        option.addEventListener('change', () => {
            if (option.value === "Cheque") {
                chequeInput.style.display = 'block';
                exchangeInput.style.display = 'none';
            } else if (option.value === "Exchange") {
                chequeInput.style.display = 'none';
                exchangeInput.style.display = 'block';
            } else {
                chequeInput.style.display = 'none';
                exchangeInput.style.display = 'none';
            }
        });
    });

    confirmPaymentButton.addEventListener('click', async () => {
        // Get selected payment option
                const selectedOption = document.querySelector('input[name="paymentOption"]:checked');

                if (!selectedOption) {
                    alert('Please select a payment option');
                    return;
                }

                if (selectedOption.value === "Cash") {
                    paymentDetails = "Cash";
                } else if (selectedOption.value === "Cheque") {
                    const chequeNumber = chequeNumberInput.value.trim();
                    if (!chequeNumber) {
                        alert('Please enter a cheque number');
                        return;
                    }
                    paymentDetails = chequeNumber;
                } else if (selectedOption.value === "Exchange") {
                    const exchangeDetails = exchangeDetailsInput.value.trim();
                    if (!exchangeDetails) {
                        alert('Please enter exchange details');
                        return;
                    }
                    // paymentDetails = `Exchange: ${exchangeDetails}`;
                    paymentDetails=exchangeDetails;
                }

                // Close the modal
                paymentModal.style.display = 'none';
                overlay.style.display = 'none';

                // Prepare receipt data
                const receiptData = {
                    customer_id: customerIdInput.value, // Assuming this is the correct customer ID field
                    purchase_date: new Date().toISOString().slice(0, 19).replace('T', ' '), // Current date in the required format
                    total_price: parseFloat(totalEl.textContent.replace('$', '')), // Remove the $ and convert to number
                    payment_status: signalSelect.value, // Assuming this is the field for payment status
                    user_id: uid, // Assuming user_id is 1 for now (this can be dynamic if needed)
                     // Add payment details here
                    items: currentSale.map(item => ({
                        product_id: item.id, // Function to map product name to product ID
                        price: item.price,
                        quantity: item.quantity
                    })),
                    payment_detail: paymentDetails,
                    discount: parseFloat(total_discount.textContent.replace('$', ''))
                };

                console.log('Formatted Receipt Data:', receiptData);
                // console.log(total_discount);
                try {
                    const response = await fetch('http://localhost:5000/api/v1/product/makeTransaction', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(receiptData),
                    });

                    if (!response.ok) {
                        throw new Error(`Failed to save receipt: ${response.statusText}`);
                    }

                    const result = await response.json();
                    alert('Receipt saved successfully!');
                    console.log('API Response:', result);
                } catch (error) {
                    console.error('Error saving receipt:', error);
                    alert('Failed to save receipt. Please try again.');
                }

                printCurrentSaleAndPayment(receiptData);
                location.reload();
            });

        closeModalButton.addEventListener('click', () => {
            paymentModal.style.display = 'none';
            overlay.style.display = 'none';
        });


    
            // Load categories for user id
            loadCategories(getUserIdFromToken());

    
        });
     
        function logout() {
            // Implement logout functionality
            localStorage.removeItem('token');
            window.location.href = 'login.html';
        }

    document.getElementById('admin-btn').addEventListener('click', async function () 
    {
    // Prompt for password
            const password = prompt("Enter admin password:");
            
            // Assuming you have a way to get the user ID, set it here
            // Prepare the payload to send to the backend
            const requestBody = {
                userid: uid,
                password: password
            };

            try {
                // Send the password and userId to the backend for validation
                const response = await fetch('http://localhost:5000/api/v1/user/admin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();

                // Check if the login was successful
                if (data.success) {
                    // Redirect to admin page on success
                    window.location.href = "../admin/indexx.html";
                } else {
                    // Show an error message on failure
                    alert(data.message || "Incorrect password.");
                }
            } catch (error) {
                console.error("Error logging in admin:", error);
                alert("An error occurred while trying to log in.");
            }
        });
        document.addEventListener("DOMContentLoaded", () => {
            const openModalBtn = document.getElementById("open-modal-btn");
            const modal = document.getElementById("vendor-modal");
            const closeModalBtn = document.querySelector(".close-btn");
            const vendorList = document.getElementById("vendor-list");
            const vendorIdInput = document.getElementById("vendor-id-input");
            // const userId = getUserIdFromToken(); // Replace with actual user ID

            // Open modal on button click
            openModalBtn.addEventListener("click", async () => {
                modal.style.display = "block";
                await fetchVendors();
            });

            // Close modal on 'X' button click
            closeModalBtn.addEventListener("click", () => {
                modal.style.display = "none";
            });

            // Close modal when clicking outside modal content
            window.addEventListener("click", (event) => {
                if (event.target === modal) {
                    modal.style.display = "none";
                }
            });

            // Fetch vendors and populate list
            async function fetchVendors() {
                try {
                    const apiUrl = `http://localhost:5000/api/v1/customer/getall/${uid}`;
                    const response = await fetch(apiUrl);
                    const data = await response.json();
                    console.log(data);
                    if (data.success) {
                        vendorList.innerHTML = ""; // Clear previous list items
                        data.data.forEach(vendor => {
                            const listItem = document.createElement("li");
                            listItem.textContent = `${vendor.name} (ID: ${vendor.customer_id})`;
                            listItem.dataset.vendorId = vendor.customer_id;

                            // Set vendor ID on list item click
                            listItem.addEventListener("click", () => {
                                vendorIdInput.value = listItem.dataset.vendorId;
                                modal.style.display = "none"; // Close the modal
                            });

                            vendorList.appendChild(listItem);
                        });
                    } else {
                        console.error(data.message);
                        vendorList.innerHTML = "<li>No vendors available.</li>";
                    }
                } catch (error) {
                    console.error("Error fetching vendor data:", error);
                    vendorList.innerHTML = "<li>Error loading vendors.</li>";
                }
            }
        });


    </script>
    
    

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz4fnFO9gybktF+z6kbuTqVDn0mgF1vj4irZyw+PQ5mHkA1Utbm24D+R1e" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-oBqDVmMz4fnFO9gybktF+z6kbuTqVDn0mgF1vj4irZyw+PQ5mHkA1Utbm24D+R1e" crossorigin="anonymous"></script>
</body>
</html>
